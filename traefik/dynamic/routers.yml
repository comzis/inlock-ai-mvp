http:
  routers:
    dashboard-root:
      entryPoints:
        - websecure
      rule: Host(`traefik.inlock.ai`) && Path(`/`)
      middlewares:
        - dashboard-redirect
      service: noop@internal
      tls:
        certResolver: le-dns
    api-root:
      entryPoints:
        - websecure
      rule: Host(`traefik.inlock.ai`) && (Path(`/api`) || Path(`/api/`))
      middlewares:
        - api-redirect
      service: noop@internal
      tls:
        certResolver: le-dns
    dashboard:
      entryPoints:
        - websecure
      rule: Host(`traefik.inlock.ai`) && (PathPrefix(`/dashboard`) || (PathPrefix(`/api/`) && !Path(`/api`) && !Path(`/api/`)))
      middlewares:
        - secure-headers
        - allowed-admins@file  # IP allowlist - check BEFORE forwardAuth
        - admin-forward-auth@file  # Use OAuth2-Proxy instead of basic auth
        - oauth-error-handler@file
        - mgmt-ratelimit@file
      service: api@internal
      priority: 100
      tls:
        certResolver: le-dns
    
    # OAuth2-Proxy callback endpoint
    oauth2-proxy:
      entryPoints:
        - websecure
      rule: Host(`auth.inlock.ai`)
      middlewares:
        - secure-headers
      service: oauth2-proxy
      tls:
        certResolver: le-dns
    
    # Homepage service - COMMENTED OUT - Replaced by Inlock AI app
    # homepage:
    #   entryPoints:
    #     - websecure
    #   rule: Host(`inlock.ai`) || Host(`www.inlock.ai`)
    #   middlewares:
    #     - secure-headers
    #   service: homepage
    #   tls:
    #     certResolver: le-tls
    
    portainer:
      entryPoints:
        - websecure
      rule: Host(`portainer.inlock.ai`)
      middlewares:
        - secure-headers
        - allowed-admins@file  # IP allowlist - check BEFORE forwardAuth
        - admin-forward-auth@file  # Use OAuth2-Proxy for Auth0
        - oauth-error-handler@file
        - mgmt-ratelimit@file
      service: portainer
      tls:
        certResolver: le-dns
    
    n8n:
      entryPoints:
        - websecure
      rule: Host(`n8n.inlock.ai`)
      middlewares:
        - secure-headers
        - allowed-admins@file  # IP allowlist - check BEFORE forwardAuth
        - admin-forward-auth@file  # Use OAuth2-Proxy for Auth0
        - oauth-error-handler@file
        - mgmt-ratelimit@file
      service: n8n
      tls:
        certResolver: le-dns
    
    
    grafana:
      entryPoints:
        - websecure
      rule: Host(`grafana.inlock.ai`)
      middlewares:
        - secure-headers
        # TEMPORARILY DISABLED: allowed-admins@file  # IP allowlist - disabled for testing
        - admin-forward-auth@file  # Use OAuth2-Proxy for Auth0
        - oauth-error-handler@file
        - mgmt-ratelimit@file
      service: grafana
      tls:
        certResolver: le-dns
    
    coolify:
      entryPoints:
        - websecure
      rule: Host(`deploy.inlock.ai`)
      middlewares:
        - secure-headers
        - allowed-admins@file  # IP allowlist - check BEFORE forwardAuth
        - admin-forward-auth@file  # Use OAuth2-Proxy for Auth0
        - oauth-error-handler@file
        - mgmt-ratelimit@file
      service: coolify
      tls:
        certResolver: le-dns
    
    homarr:
      entryPoints:
        - websecure
      rule: Host(`dashboard.inlock.ai`)
      middlewares:
        - secure-headers
        - allowed-admins@file  # IP allowlist - check BEFORE forwardAuth
        - admin-forward-auth@file  # Use OAuth2-Proxy for Auth0
        - oauth-error-handler@file
        - mgmt-ratelimit@file
      service: homarr
      tls:
        certResolver: le-dns
    
    # Inlock AI application - Main production route
    # Routes inlock.ai and www.inlock.ai to the Inlock AI app using Positive SSL
    # Docker provider disabled, so router is only defined here (file provider)
    inlock-ai:
      entryPoints:
        - websecure
      rule: Host(`inlock.ai`) || Host(`www.inlock.ai`)
      middlewares:
        - secure-headers
      service: inlock-ai
      tls:
        options: default  # Uses Positive SSL certificate