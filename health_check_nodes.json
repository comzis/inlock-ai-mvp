 [{"parameters":{"rule":{"interval":[{"field":"hours"}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1,"position":[-272,208],"id":"277535ee-7c4b-47ae-8b97-64b3162c7c69","name":"Every 1 Hour"},{"parameters":{"url":"https://inlock.ai","options":{"timeout":5000}},"type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[0,0],"id":"0a8b534c-82cf-4af4-81c0-c1bd1ef8340e","name":"Check Homepage","continueOnFail":true},{"parameters":{"url":"https://n8n.inlock.ai","options":{"timeout":5000}},"type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[0,208],"id":"fc8f7852-440e-42b9-a507-d39817dcd6b6","name":"Check n8n (External)","continueOnFail":true},{"parameters":{"url":"http://traefik:8080/ping","options":{"timeout":5000}},"type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[0,400],"id":"e2e0e139-c07b-4358-9267-9592ceebba3e","name":"Check Traefik (Internal)","continueOnFail":true},{"parameters":{"url":"http://portainer:9000","options":{"timeout":5000}},"type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[0,608],"id":"3ff6b1c4-0033-48eb-9e86-694de415d74f","name":"Check Portainer (Internal)","continueOnFail":true},{"parameters":{"jsCode":"const results = $('Merge Checks').all();\nconst failures = [];\n\nresults.forEach(item => {\n  const key = Object.keys(item.json)[0]; \n  // n8n merge node might behave differently depending on inputs, simplifying logic\n  // Check for error property or status code != 200\n  if (item.error) {\n      failures.push({ service: 'unknown', error: item.error.message });\n  } \n});\n\n// Check individual node executions\nconst nodesToCheck = ['Check Homepage', 'Check n8n (External)', 'Check Traefik (Internal)', 'Check Portainer (Internal)'];\n\nfor (const nodeName of nodesToCheck) {\n    let items = [];\n    try {\n        items = $items(nodeName);\n    } catch (e) {\n        // Node did not execute\n        items = [];\n    }\n    \n    if (items.length > 0) {\n        // If node ran, check if it failed (it continues on fail)\n        // In n8n v1, failed execution with continueOnFail might wrap data\n        const firstItem = items[0];\n        if (firstItem.json.error || (firstItem.json.status && firstItem.json.status !== 200)) {\n             failures.push({\n                 service: nodeName,\n                 status: firstItem.json.status || 'ERROR',\n                 error: firstItem.json.error || 'Unknown Error'\n             });\n        }\n    } else {\n        failures.push({ service: nodeName, error: 'Did not run or execution skipped' });\n    }\n}\n\nreturn { failures, isHealthy: failures.length === 0 };"},"type":"n8n-nodes-base.code","typeVersion":1,"position":[448,208],"id":"96e09546-14b9-4d24-8200-420ac2bc0474","name":"Analyze Results"},{"parameters":{"conditions":{"boolean":[{"value1":"={{ $json.isHealthy }}","value2":true}]}},"type":"n8n-nodes-base.if","typeVersion":1,"position":[672,208],"id":"71cec503-a910-4385-8315-5439197b1f48","name":"Is Healthy?"},{"parameters":{"resource":"__CUSTOM_API_CALL__","requestOptions":{}},"type":"n8n-nodes-base.openAi","typeVersion":1,"position":[912,320],"id":"36b98faa-75d6-430f-a5b2-caa81f2ba4e0","name":"AI SRE Agent","alwaysOutputData":false,"credentials":{"openAiApi":{"id":"5zBJr3QZ6OTaVbzh","name":"OpenAi account 2"}}},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[912,112],"id":"de79df64-a864-4537-9ee9-6016132f7978","name":"Healthy - Do Nothing"},{"parameters":{"fromEmail":"n8n@inlock.ai","toEmail":"comzis@hotmail.com","subject":"=[Alert] App Health Check Failed - {{ $today }}","text":"={{ $json.content }}","options":{}},"type":"n8n-nodes-base.emailSend","typeVersion":2,"position":[1152,320],"id":"37a01383-0df6-473a-95d5-777ecb3a07b4","name":"Send Email Alert","webhookId":"a467ff64-dd41-4546-9206-3888f08f6399","credentials":{"smtp":{"id":"skDmYZMZsDC0LGBI","name":"SMTP account"}}},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":1,"position":[224,208],"id":"6c149c01-48b1-4521-925e-f0c32a964e18","name":"Merge Checks"},{"parameters":{"fromEmail":"n8n@inlock.ai","toEmail":"comzis@hotmail.com","subject":"=[Alert] App Health Check Failed - {{ $today }}","text":"={{ $json.content }}","options":{}},"type":"n8n-nodes-base.emailSend","typeVersion":2,"position":[1088,112],"id":"83377374-6b0d-429d-8af4-6b05a9163b17","name":"Send Email Alert1","webhookId":"a467ff64-dd41-4546-9206-3888f08f6399","credentials":{"smtp":{"id":"skDmYZMZsDC0LGBI","name":"SMTP account"}}}]

